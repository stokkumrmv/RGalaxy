<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Lodewic van Twillert" />

<meta name="date" content="2018-06-15" />

<title>R functions to Galaxy tools</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">R functions to Galaxy tools</h1>
<h4 class="author"><em>Lodewic van Twillert</em></h4>
<h4 class="date"><em>2018-06-15</em></h4>



<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(RGalaxy)</span>

<span class="co"># library(RGalaxify) </span>
<span class="co"># Alternatively, source all code</span>
<span class="cf">for</span> (fname <span class="cf">in</span> <span class="kw">dir</span>(<span class="st">&quot;../R/&quot;</span>)) <span class="kw">source</span>(<span class="kw">file.path</span>(<span class="st">&quot;../R&quot;</span>, fname))
<span class="kw">library</span>(XML)
<span class="co">#&gt; Warning: package 'XML' was built under R version 3.4.4</span>
<span class="kw">library</span>(tools)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'tools'</span>
<span class="co">#&gt; The following object is masked from 'package:XML':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     toHTML</span>
<span class="co"># library(RGalaxy) # We still need some core functions that we haven't edited yet</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">addCommandXML &lt;-<span class="st"> </span><span class="cf">function</span>(funcName, funcInfo, xml) {
  <span class="co"># Make command text</span>
  commandText &lt;-<span class="st"> </span><span class="kw">paste</span>(funcName, <span class="st">&quot;.R</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
      
  <span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">names</span>(funcInfo))
  {
      commandText &lt;-<span class="st"> </span><span class="kw">paste</span>(commandText, <span class="st">&quot;       &quot;</span>,
          <span class="kw">sprintf</span>(<span class="st">&quot;#if str($%s).strip() != </span><span class="ch">\&quot;\&quot;</span><span class="st">:</span><span class="ch">\n</span><span class="st">&quot;</span>, nm),
          <span class="st">&quot;          &quot;</span>, <span class="kw">sprintf</span>(<span class="st">&quot;--%s=</span><span class="ch">\&quot;</span><span class="st">$%s</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, nm, nm),
          <span class="st">&quot;</span><span class="ch">\n</span><span class="st">       #end if</span><span class="ch">\n</span><span class="st">&quot;</span>,
          <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
  }
  
  command.pre &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">c</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">    ######### one important path:&quot;</span>,
                          <span class="st">&quot;    ######### 1. path to tool installation directory&quot;</span>,
                          <span class="st">&quot;    export TOOL_INSTALL_DIR='${__tool_directory__}' &amp;&amp;</span><span class="ch">\n</span><span class="st">&quot;</span>),
                          <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
      
  commandText &lt;-<span class="st"> </span><span class="kw">gsub</span>(funcName, <span class="kw">paste0</span>(<span class="st">&quot;'$__tool_directory__/&quot;</span>, funcName), commandText)
  commandText &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">c</span>(command.pre, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">    Rscript &quot;</span>, commandText), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)
  
  commandNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;command&quot;</span>,
                            <span class="dt">parent =</span> xml,
                            <span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">interpreter =</span> <span class="st">&quot;Rscript --vanilla&quot;</span>,
                                         <span class="dt">detect_errors =</span> <span class="st">&quot;exit_code&quot;</span>),
                            <span class="kw">newXMLCDataNode</span>(commandText))
  <span class="kw">return</span>(xml)
}

addParamsXML &lt;-<span class="st"> </span><span class="cf">function</span>(funcName, funcInfo, xml) {
  functionToGalaxify &lt;-<span class="st"> </span><span class="kw">get</span>(funcName)
  
  inputsNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;inputs&quot;</span>, <span class="dt">parent=</span>xml)
  outputsNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;outputs&quot;</span>, <span class="dt">parent=</span>xml)
  testsNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;tests&quot;</span>, <span class="dt">parent=</span>xml)
  
  <span class="co"># Loop over Galaxy Parameter Class arguments of the given function</span>
  <span class="co">#   Each parameter is classified with an if/else chain and</span>
  <span class="co">#   the resulting xml-tags are defined accordingly</span>
  <span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">names</span>(funcInfo))
{
    item &lt;-<span class="st"> </span>funcInfo[nm][[<span class="dv">1</span>]]
    galaxyItem &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">formals</span>(functionToGalaxify)[nm][[<span class="dv">1</span>]])
    <span class="cf">if</span> (<span class="op">!</span>item<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;GalaxyOutput&quot;</span>)
    {
        paramNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;param&quot;</span>, <span class="dt">parent=</span>inputsNode)
        <span class="cf">if</span> (galaxyItem<span class="op">@</span>required)
        {
            validatorNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;validator&quot;</span>, <span class="dt">parent=</span>paramNode)
            <span class="kw">xmlAttrs</span>(validatorNode)[<span class="st">&quot;type&quot;</span>] &lt;-<span class="st"> &quot;empty_field&quot;</span>
            <span class="kw">xmlAttrs</span>(validatorNode)[<span class="st">&quot;message&quot;</span>] &lt;-<span class="st"> </span>galaxyItem<span class="op">@</span>requiredMsg
            <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">'optional'</span>] &lt;-<span class="st"> 'false'</span>
        } <span class="cf">else</span> {
            validatorNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;validator&quot;</span>, <span class="dt">parent=</span>paramNode)
            <span class="kw">xmlAttrs</span>(validatorNode)[<span class="st">&quot;type&quot;</span>] &lt;-<span class="st"> &quot;empty_field&quot;</span>
            ##dummyParam &lt;- GalaxyParam()
            <span class="kw">xmlAttrs</span>(validatorNode)[<span class="st">&quot;message&quot;</span>] &lt;-
<span class="st">                </span>galaxyItem<span class="op">@</span>requiredMsg
            <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">'optional'</span>] &lt;-<span class="st"> 'true'</span>
        }
        <span class="cf">if</span> (item<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;GalaxyInputFile&quot;</span>)
        {
            <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">&quot;optional&quot;</span>] &lt;-
<span class="st">                </span><span class="kw">tolower</span>(
                    <span class="kw">as.character</span>(<span class="op">!</span><span class="kw">eval</span>(<span class="kw">formals</span>(functionToGalaxify)[[nm]])<span class="op">@</span>required))
        }
        
        <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span>nm
        type &lt;-<span class="st"> </span>RtoGalaxyTypeMap[[item<span class="op">$</span>type]]
        <span class="cf">if</span> (item<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;GalaxyInputFile&quot;</span>)
        {
            type &lt;-<span class="st"> &quot;data&quot;</span>
            <span class="cf">if</span> (<span class="kw">length</span>(galaxyItem<span class="op">@</span>formatFilter))
                <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">&quot;format&quot;</span>] &lt;-<span class="st"> </span>galaxyItem<span class="op">@</span>formatFilter
            <span class="cf">else</span>
                <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">&quot;format&quot;</span>] &lt;-<span class="st"> &quot;data&quot;</span> <span class="co">#default format of an input file</span>
        }
        <span class="cf">if</span> (item<span class="op">$</span>length <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">||</span><span class="st"> &quot;GalaxySelectParam&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">class</span>(galaxyItem))
        {
            type &lt;-<span class="st"> &quot;select&quot;</span>
        }
        <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">&quot;type&quot;</span>] &lt;-<span class="st"> </span>type

        <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(item<span class="op">$</span>default))
            <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">&quot;value&quot;</span>] &lt;-<span class="st"> </span><span class="kw">eval</span>(item<span class="op">$</span>default)
        <span class="cf">else</span>
            <span class="cf">if</span> (type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;integer&quot;</span>, <span class="st">&quot;float&quot;</span>))
                <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">&quot;value&quot;</span>] &lt;-<span class="st"> &quot;&quot;</span>

        <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">&quot;help&quot;</span>] &lt;-<span class="st"> </span><span class="kw">getHelpFromText</span>(rd, nm)
        
        <span class="cf">if</span> (<span class="kw">length</span>(galaxyItem<span class="op">@</span>label)) ## this really should always be true!
            item<span class="op">$</span>label &lt;-<span class="st"> </span>galaxyItem<span class="op">@</span>label

        <span class="cf">if</span> ( galaxyItem<span class="op">@</span>required){
            item<span class="op">$</span>label &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;[required]&quot;</span>, item<span class="op">$</span>label)
        }
        

        <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;boolean&quot;</span>)
        {
            <span class="cf">if</span> (<span class="kw">length</span>(galaxyItem<span class="op">@</span>checked))
                <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">'checked'</span>] &lt;-
<span class="st">                    </span><span class="kw">tolower</span>(<span class="kw">as.character</span>(galaxyItem<span class="op">@</span>checked))
        }

        <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;text&quot;</span>) {
            galaxyItem
            <span class="cf">if</span> (<span class="kw">length</span>(galaxyItem<span class="op">@</span>size))
            <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">'size'</span>] =<span class="st"> </span><span class="kw">as.character</span>(galaxyItem<span class="op">@</span>size)
        }

        <span class="cf">if</span>(type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;integer&quot;</span>, <span class="st">&quot;float&quot;</span>))
        {
            <span class="cf">if</span>(<span class="kw">length</span>(galaxyItem<span class="op">@</span>min))
                <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">'min'</span>] &lt;-<span class="st"> </span><span class="kw">as.character</span>(galaxyItem<span class="op">@</span>min)
            <span class="cf">if</span>(<span class="kw">length</span>(galaxyItem<span class="op">@</span>max))
                <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">'max'</span>] &lt;-<span class="st"> </span><span class="kw">as.character</span>(galaxyItem<span class="op">@</span>max)
        }

        
        <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">'label'</span>] &lt;-<span class="st"> </span>item<span class="op">$</span>label
        
        
        <span class="cf">if</span> (type<span class="op">==</span><span class="st">&quot;select&quot;</span>)
        {
            <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">'force_select'</span>] &lt;-
<span class="st">                </span><span class="kw">as.character</span>(galaxyItem<span class="op">@</span>force_select)
            <span class="cf">if</span> (<span class="kw">length</span>(galaxyItem<span class="op">@</span>display))
                <span class="kw">xmlAttrs</span>(paramNode)[<span class="st">'display'</span>] &lt;-
<span class="st">                    </span><span class="kw">as.character</span>(galaxyItem<span class="op">@</span>display)

            <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(item<span class="op">$</span>selectoptions))
            {
                selectoptions &lt;-<span class="st"> </span><span class="kw">eval</span>(item<span class="op">$</span>selectoptions)
                idx &lt;-<span class="st"> </span><span class="dv">1</span>
                <span class="cf">for</span> (value <span class="cf">in</span> selectoptions)
                {
                    option &lt;-<span class="st"> </span><span class="kw">names</span>(selectoptions)[[idx]]
                    <span class="cf">if</span> (<span class="kw">is.null</span>(option)) option &lt;-<span class="st"> </span>value
                    optionNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;option&quot;</span>, option,
                        <span class="dt">parent=</span>paramNode)
                    <span class="kw">xmlAttrs</span>(optionNode)[<span class="st">'value'</span>] &lt;-<span class="st"> </span>value
                    idx &lt;-<span class="st"> </span>idx <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
                }
                
            }

        }
        <span class="kw">invisible</span>(<span class="ot">NULL</span>)
        
    } <span class="cf">else</span>
    {
        dataNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;data&quot;</span>, <span class="dt">parent=</span>outputsNode)
        <span class="cf">if</span> (<span class="kw">is.null</span>(item<span class="op">$</span>default))
            <span class="kw">gstop</span>(<span class="kw">sprintf</span>(<span class="st">&quot;GalaxyOutput '%s' must have a parameter.&quot;</span>, nm))
        galaxyOutput &lt;-<span class="st"> </span><span class="kw">eval</span>(item<span class="op">$</span>default)
        <span class="kw">xmlAttrs</span>(dataNode)[<span class="st">&quot;format&quot;</span>] &lt;-<span class="st"> </span>galaxyOutput<span class="op">@</span>format
        <span class="kw">xmlAttrs</span>(dataNode)[<span class="st">&quot;name&quot;</span>] &lt;-<span class="st"> </span>nm
        <span class="kw">xmlAttrs</span>(dataNode)[<span class="st">&quot;label&quot;</span>] &lt;-<span class="st"> </span><span class="kw">as.character</span>(galaxyOutput)
        
    }
  
  }
  <span class="kw">return</span>(xml)
}</code></pre></div>
<div id="generating-a-galaxy-tool-from-local-r-scripts" class="section level1">
<h1>Generating a Galaxy tool from local R scripts</h1>
<p>This vignette is the first attempt to generate a Galaxy tool from an arbitrary R script. The script is expected to include functions with roxygen-style documentation.</p>
<p>Also, these R functions should be lightly edited so that their expected parameters can be parsed by the functions from the <a href="https://bioconductor.org/packages/release/bioc/html/RGalaxy.html">RGalaxy</a> package.</p>
<p>The biggest shortcoming of the RGalaxy package in my opinion is that the generated tool script relies on the used R function to be in a publically available package. The Galaxy tools will not include the right requirements tags needed to publish the generated Galaxy tools to any Galaxy instance.</p>
<p>Our approach will use a lot of the functionality of the RGalaxy package, but rewritten in a way that we use arbitrary custom R functions. To see an example workflow of how to generate tools using RGalaxy, see <a href="https://bioconductor.org/packages/release/bioc/vignettes/RGalaxy/inst/doc/RGalaxy-vignette.html">this RGalaxy vignette</a>. However, the vignette is not very easy to follow but it shows some examples and descriptions that we won’t go over in this document.</p>
</div>
<div id="creating-a-basic-galaxy-tool" class="section level1">
<h1>Creating a basic galaxy tool</h1>
<p>Your R scripts need to be self-contained function definitions, for now. Later this should be extended to include tools that depend on other local functions that may be loaded with a simple <code>source()</code> command.</p>
<p>The source R scripts can be given as a character vector of filenames, relative to the current working directory.</p>
<div id="addtwonumberswithtest" class="section level2">
<h2>AddTwoNumbersWithTest</h2>
<p>In this case we use the <code>addTwoNumbersWithTest.R</code>. This file includes one very simple function defintion. All this script included is a function to sum two numbers and write the output to a file. In Galaxy we always expect the output to be a file, or collection of files. You can output R variables in .rds format, which may force you to change some other functions to take a file input rather than just an R variable.</p>
<p>Notice the following about the function definition below,</p>
<ul>
<li><a href="http://kbroman.org/pkg_primer/pages/docs.html">roxygen2</a>-style comments for function documentation</li>
<li>The input parameters are <a href="https://rdrr.io/bioc/RGalaxy/man/GalaxyClasses.html">Galaxy Parameter Classes</a></li>
<li>The output is written to a .txt file</li>
</ul>
<p>The documentation is used to create a help section to display in Galaxy.</p>
<p>The input parameters are defined by Galaxy Parameter Classes, following the methods in the RGalaxy package. This allows galaxy to understand the expected parameters and show them nicely in the Galaxy UI.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The addTwoNumbersTest.R file</span>

<span class="co">#' Add to numbers</span>
<span class="co">#' </span>
<span class="co">#' A test function to use as an example to create a galaxy tool.</span>
<span class="co">#' It takes two numeric values and returns the sum to a .txt file.</span>
<span class="co">#'</span>
<span class="co">#' @param number1 First numeric value to sum</span>
<span class="co">#' @param number2 Second numeric value to sum</span>
<span class="co">#' @param sum Output file</span>
<span class="co">#' </span>
<span class="co">#' @details</span>
<span class="co">#' Both arguments are required and contain test values to</span>
<span class="co">#' automatically generate tool tests with.</span>
<span class="co">#' These tests are included in the output .xml tool definition, and</span>
<span class="co">#' can be tested using Planemo's test command.</span>
<span class="co">#'</span>
<span class="co">#' @return The sum of two values</span>
<span class="co">#' @export</span>
<span class="co">#'</span>
<span class="co">#' @examples</span>
<span class="co"># outfile &lt;- tempfile(pattern = &quot;sum&quot;)</span>
<span class="co"># addTwoNumbersWithTest(5, 5, sum = outfile)</span>
<span class="co"># readLines(outfile)</span>
<span class="co">#' </span>
addTwoNumbersWithTest &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">function</span>(
    <span class="dt">number1=</span><span class="kw">GalaxyNumericParam</span>(<span class="dt">required=</span><span class="ot">TRUE</span>, <span class="dt">testValues=</span>5L),
    <span class="dt">number2=</span><span class="kw">GalaxyNumericParam</span>(<span class="dt">required=</span><span class="ot">TRUE</span>, <span class="dt">testValues=</span>5L),
    <span class="dt">sum=</span><span class="kw">GalaxyOutput</span>(<span class="st">&quot;sum&quot;</span>, <span class="st">&quot;txt&quot;</span>))
  {
    <span class="kw">cat</span>(<span class="kw">paste0</span>(number1 <span class="op">+</span><span class="st"> </span>number2, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>), <span class="dt">file=</span>sum)
  }</code></pre></div>
<p>You can still use this function straight in R, which is handy for testing but in many cases you could just make it a habit of writing function definitions like this right away!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Example of function output using normal R variables</span>
outfile &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
<span class="kw">addTwoNumbersWithTest</span>(<span class="dt">number1 =</span> <span class="dv">5</span>, <span class="dt">number2 =</span> <span class="dv">5</span>, <span class="dt">sum =</span> outfile)
<span class="kw">readLines</span>(outfile)
<span class="co">#&gt; [1] &quot;10&quot;</span></code></pre></div>
</div>
<div id="setting-up-tool-output" class="section level2">
<h2>Setting up tool output</h2>
<p>The output will be written to a tool directory, <code>toolDir</code>. You may have only 1 tool directory but still have different groups of tools, set by <code>toolGroup</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">toolScripts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;addTwoNumbersWithTest.R&quot;</span>)
toolDir &lt;-<span class="st"> &quot;tools&quot;</span>
toolGroup &lt;-<span class="st"> &quot;mytool&quot;</span>
toolPath &lt;-<span class="st"> </span><span class="kw">file.path</span>(toolDir, toolGroup)

<span class="co"># Create tool directory if it does not yet exist</span>
<span class="cf">if</span> (<span class="op">!</span><span class="kw">dir.exists</span>(toolPath)) {
  <span class="kw">warning</span>(<span class="kw">sprintf</span>(<span class="st">&quot;Tool directory '%s' does not exist and will be created&quot;</span>,
                  toolPath))
  <span class="kw">dir.create</span>(toolPath, <span class="dt">recursive =</span> T)
}
<span class="co">#&gt; Warning: Tool directory 'tools/mytool' does not exist and will be created</span></code></pre></div>
</div>
<div id="creating-temporary-package" class="section level2">
<h2>Creating temporary package</h2>
<p>Since our functions to transform into galaxy tools are not part of a package we can’t just use <code>roxygen2::roxygenise()</code>. For us to create documentation the scripts need to be part of a package. So we create a temporary package for our functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(devtools)
<span class="co">#&gt; Loading required package: devtools</span>

<span class="co"># Create temporary package directory</span>
tempPackageDir &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&quot;TempGalaxyToolPackage&quot;</span>)
<span class="co"># Initialize R package file structure</span>
<span class="cf">if</span> (<span class="kw">dir.exists</span>(tempPackageDir)) <span class="kw">unlink</span>(tempPackageDir, <span class="dt">recursive =</span> T)
devtools<span class="op">::</span><span class="kw">create</span>(<span class="dt">path =</span> tempPackageDir,
                 <span class="dt">rstudio =</span> F)
<span class="co">#&gt; Creating package 'TempGalaxyToolPackage' in 'C:/Users/twillerthtlv/AppData/Local/Temp/Rtmp0QFmZt'</span>
<span class="co">#&gt; No DESCRIPTION found. Creating with values:</span>
<span class="co">#&gt; Package: TempGalaxyToolPackage</span>
<span class="co">#&gt; Title: What the Package Does (one line, title case)</span>
<span class="co">#&gt; Version: 0.0.0.9000</span>
<span class="co">#&gt; Authors@R: person(&quot;First&quot;, &quot;Last&quot;, email = &quot;first.last@example.com&quot;, role = c(&quot;aut&quot;, &quot;cre&quot;))</span>
<span class="co">#&gt; Description: What the package does (one paragraph).</span>
<span class="co">#&gt; Depends: R (&gt;= 3.4.3)</span>
<span class="co">#&gt; License: What license is it under?</span>
<span class="co">#&gt; Encoding: UTF-8</span>
<span class="co">#&gt; LazyData: true</span>

<span class="co"># Copy scripts to package R directory</span>
<span class="kw">file.copy</span>(<span class="dt">from =</span> toolScripts, <span class="dt">to =</span> <span class="kw">file.path</span>(tempPackageDir, <span class="st">&quot;R&quot;</span>))
<span class="co">#&gt; [1] TRUE</span>
<span class="co"># Document R functions in the R directory</span>
devtools<span class="op">::</span><span class="kw">document</span>(tempPackageDir)
<span class="co">#&gt; Updating TempGalaxyToolPackage documentation</span>
<span class="co">#&gt; Loading TempGalaxyToolPackage</span>
<span class="co">#&gt; Updating roxygen version in C:\Users\twillerthtlv\AppData\Local\Temp\Rtmp0QFmZt\TempGalaxyToolPackage/DESCRIPTION</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing NAMESPACE</span>
<span class="co">#&gt; Writing addTwoNumbersWithTest.Rd</span>

<span class="co"># File directory example</span>
<span class="kw">list.files</span>(tempPackageDir, <span class="dt">recursive =</span> T)
<span class="co">#&gt; [1] &quot;DESCRIPTION&quot;                  &quot;man/addTwoNumbersWithTest.Rd&quot;</span>
<span class="co">#&gt; [3] &quot;NAMESPACE&quot;                    &quot;R/addTwoNumbersWithTest.R&quot;</span></code></pre></div>
<p>For every <strong>documented</strong> function we can create a galaxy tool. Every function gets its own .Rd file in the <code>man/</code> directory. Using this we can list the functions to galaxify.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># List all functions to galaxify</span>
<span class="co">#   Based on the criteria that they need to be documented</span>
functionDocs &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(tempPackageDir, <span class="st">&quot;man&quot;</span>))
<span class="co"># Only 1 function in this case, otherwise we should create a loop.</span>
funcName &lt;-<span class="st"> </span><span class="kw">sapply</span>(functionDocs, gsub, <span class="dt">pattern =</span> <span class="st">&quot;.Rd&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">cat</span>(funcName,
    <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
<span class="co">#&gt; addTwoNumbersWithTest</span></code></pre></div>
</div>
<div id="prepare-documentation-and-function-definition" class="section level2">
<h2>Prepare documentation and function definition</h2>
<p>Firstly we need to gather the documentation for our new tool/function. This can be found in the <code>man/</code> directory of our temporary package.</p>
<p>Here we print the contents of the .Rd documentation file created when we ran the <code>devtools::document()</code> function. These files get created by the <code>roxygen2</code>package, look up the documentation if you wish to learn more about the options and formatting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rd &lt;-<span class="st"> </span>tools<span class="op">::</span><span class="kw">parse_Rd</span>(<span class="kw">file.path</span>(tempPackageDir, <span class="st">&quot;man&quot;</span>, functionDocs))
<span class="kw">print</span>(rd)
<span class="co">#&gt; % Generated by roxygen2: do not edit by hand</span>
<span class="co">#&gt; % Please edit documentation in R/addTwoNumbersWithTest.R</span>
<span class="co">#&gt; \name{addTwoNumbersWithTest}</span>
<span class="co">#&gt; \alias{addTwoNumbersWithTest}</span>
<span class="co">#&gt; \title{Add two numbers}</span>
<span class="co">#&gt; \usage{</span>
<span class="co">#&gt; addTwoNumbersWithTest(number1 = GalaxyNumericParam(required = TRUE, testValues</span>
<span class="co">#&gt;   = 5), number2 = GalaxyNumericParam(required = TRUE, testValues = 5),</span>
<span class="co">#&gt;   sum = GalaxyOutput(&quot;sum&quot;, &quot;txt&quot;))</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; \arguments{</span>
<span class="co">#&gt; \item{number1}{First numeric value to sum}</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; \item{number2}{Second numeric value to sum}</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; \item{sum}{Output file}</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; \value{</span>
<span class="co">#&gt; The sum of two values</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; \description{</span>
<span class="co">#&gt; A test function to use as an example to create a galaxy tool.</span>
<span class="co">#&gt; It takes two numeric values and returns the sum to a .txt file.</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; \details{</span>
<span class="co">#&gt; Both arguments are required and contain test values to</span>
<span class="co">#&gt; automatically generate tool tests with.</span>
<span class="co">#&gt; These tests are included in the output .xml tool definition, and</span>
<span class="co">#&gt; can be tested using Planemo's test command.</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; \examples{</span>
<span class="co">#&gt; outfile &lt;- tempfile(pattern = &quot;sum&quot;)</span>
<span class="co">#&gt; addTwoNumbersWithTest(5, 5, sum = outfile)</span>
<span class="co">#&gt; readLines(outfile)</span>
<span class="co">#&gt; }</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fullToolDir &lt;-<span class="st"> </span>toolPath
scriptFileName &lt;-<span class="st">  </span>toolScripts
<span class="kw">source</span>(scriptFileName)
functionToGalaxify &lt;-<span class="st"> </span><span class="kw">get</span>(funcName) <span class="co"># Get the function to galaxify</span>
funcInfo &lt;-<span class="st"> </span><span class="kw">list</span>()
<span class="kw">print</span>(<span class="kw">formals</span>(functionToGalaxify))
<span class="co">#&gt; $number1</span>
<span class="co">#&gt; GalaxyNumericParam(required = TRUE, testValues = 5)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $number2</span>
<span class="co">#&gt; GalaxyNumericParam(required = TRUE, testValues = 5)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sum</span>
<span class="co">#&gt; GalaxyOutput(&quot;sum&quot;, &quot;txt&quot;)</span></code></pre></div>
</div>
<div id="get-function-parameters" class="section level2">
<h2>Get function parameters</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span>  (  <span class="kw">length</span>(<span class="kw">names</span>(<span class="kw">formals</span>(functionToGalaxify)))   <span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">formals</span>(functionToGalaxify)) )
  <span class="kw">gstop</span>(<span class="st">&quot;All arguments to Galaxy must be named.&quot;</span>)

<span class="cf">for</span> (param <span class="cf">in</span> <span class="kw">names</span>(<span class="kw">formals</span>(functionToGalaxify)))
  funcInfo[[param]] &lt;-<span class="st"> </span><span class="kw">getFuncInfo</span>(functionToGalaxify, param)
<span class="co">#&gt; GalaxyNumericParam(required = TRUE, testValues = 5)</span>
<span class="co">#&gt; $param</span>
<span class="co">#&gt; [1] &quot;number1&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $type</span>
<span class="co">#&gt; [1] &quot;GalaxyNumericParam&quot;</span>
<span class="co">#&gt; attr(,&quot;package&quot;)</span>
<span class="co">#&gt; [1] &quot;.GlobalEnv&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; GalaxyNumericParam(required = TRUE, testValues = 5)</span>
<span class="co">#&gt; $param</span>
<span class="co">#&gt; [1] &quot;number2&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $type</span>
<span class="co">#&gt; [1] &quot;GalaxyNumericParam&quot;</span>
<span class="co">#&gt; attr(,&quot;package&quot;)</span>
<span class="co">#&gt; [1] &quot;.GlobalEnv&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; GalaxyOutput(&quot;sum&quot;, &quot;txt&quot;)</span>
<span class="co">#&gt; $param</span>
<span class="co">#&gt; [1] &quot;sum&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $type</span>
<span class="co">#&gt; [1] &quot;GalaxyOutput&quot;</span>
<span class="co">#&gt; attr(,&quot;package&quot;)</span>
<span class="co">#&gt; [1] &quot;.GlobalEnv&quot;</span>

<span class="co"># # print(funcInfo)</span>
<span class="co"># if (!isTestable(funcInfo, funcName, package, functionalTestDirectory)) </span>
<span class="co">#   gwarning(&quot;Not enough information to create a functional test.&quot;)</span>
  
<span class="cf">if</span> (<span class="op">!</span><span class="kw">suppressWarnings</span>(<span class="kw">any</span>(<span class="kw">lapply</span>(funcInfo,
  <span class="cf">function</span>(x)x<span class="op">$</span>type<span class="op">==</span><span class="st">&quot;GalaxyOutput&quot;</span>))))
{
  <span class="kw">gstop</span>(<span class="kw">paste</span>(<span class="st">&quot;You must supply at least one GalaxyOutput&quot;</span>,
      <span class="st">&quot;object.&quot;</span>))
}</code></pre></div>
</div>
</div>
<div id="further-work" class="section level1">
<h1>Further work</h1>
<p>This is still a work in progress, below are the next steps to rewrite. All this code is taken from the RGalaxy package, or specifically from my edited Github mirror of it <a href="https://github.com/Lodewic/RGalaxy">found here</a>.</p>
<p>Look for the <code>R/</code> repository and you’ll find the <code>R/galaxy.R</code> script that contains most of the functions we need. Although many of the functions we DONT need, so we will work on rewriting the required functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span>  (  <span class="kw">length</span>(<span class="kw">names</span>(<span class="kw">formals</span>(functionToGalaxify)))   <span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">formals</span>(functionToGalaxify)) )
  <span class="kw">gstop</span>(<span class="st">&quot;All arguments to Galaxy must be named.&quot;</span>)

<span class="cf">for</span> (param <span class="cf">in</span> <span class="kw">names</span>(<span class="kw">formals</span>(functionToGalaxify)))
  funcInfo[[param]] &lt;-<span class="st"> </span><span class="kw">getFuncInfo</span>(functionToGalaxify, param)

<span class="co"># print(funcInfo)</span>
<span class="cf">if</span> (<span class="op">!</span><span class="kw">isTestable</span>(funcInfo, funcName, package, functionalTestDirectory)) 
  <span class="kw">gwarning</span>(<span class="st">&quot;Not enough information to create a functional test.&quot;</span>)
  
<span class="cf">if</span> (<span class="op">!</span><span class="kw">suppressWarnings</span>(<span class="kw">any</span>(<span class="kw">lapply</span>(funcInfo,
  <span class="cf">function</span>(x)x<span class="op">$</span>type<span class="op">==</span><span class="st">&quot;GalaxyOutput&quot;</span>))))
{
  <span class="kw">gstop</span>(<span class="kw">paste</span>(<span class="st">&quot;You must supply at least one GalaxyOutput&quot;</span>,
      <span class="st">&quot;object.&quot;</span>))
}

galaxyConfig &lt;-<span class="st"> </span><span class="kw">GalaxyConfig</span>(<span class="kw">getwd</span>(), <span class="dt">toolDir =</span> <span class="st">&quot;tools&quot;</span>, <span class="dt">sectionName =</span> <span class="st">&quot;vignetteTool&quot;</span>, <span class="st">&quot;vignetteId&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="op">!</span><span class="kw">dir.exists</span>(<span class="kw">file.path</span>(toolPath, <span class="st">&quot;test-data&quot;</span>))) {
  <span class="kw">message</span>(<span class="st">&quot;Functional test data directory does not exist. /test-data will be created but you will need to add your test input data files to this folder.&quot;</span>)
  <span class="kw">dir.create</span>(<span class="kw">file.path</span>(toolPath, <span class="st">&quot;test-data&quot;</span>))
}
<span class="co">#&gt; Functional test data directory does not exist. /test-data will be created but you will need to add your test input data files to this folder.</span>

funcTestSuccess &lt;-<span class="st"> </span><span class="kw">CreateFunctionalTest</span>(funcName, 
                                        <span class="dt">functionalTestDirectory =</span> <span class="kw">file.path</span>(toolPath, <span class="st">&quot;test-data&quot;</span>))
<span class="co">#&gt; GalaxyNumericParam(required = TRUE, testValues = 5)</span>
<span class="co">#&gt; $param</span>
<span class="co">#&gt; [1] &quot;number1&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $type</span>
<span class="co">#&gt; [1] &quot;GalaxyNumericParam&quot;</span>
<span class="co">#&gt; attr(,&quot;package&quot;)</span>
<span class="co">#&gt; [1] &quot;.GlobalEnv&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; GalaxyNumericParam(required = TRUE, testValues = 5)</span>
<span class="co">#&gt; $param</span>
<span class="co">#&gt; [1] &quot;number2&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $type</span>
<span class="co">#&gt; [1] &quot;GalaxyNumericParam&quot;</span>
<span class="co">#&gt; attr(,&quot;package&quot;)</span>
<span class="co">#&gt; [1] &quot;.GlobalEnv&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; GalaxyOutput(&quot;sum&quot;, &quot;txt&quot;)</span>
<span class="co">#&gt; $param</span>
<span class="co">#&gt; [1] &quot;sum&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $type</span>
<span class="co">#&gt; [1] &quot;GalaxyOutput&quot;</span>
<span class="co">#&gt; attr(,&quot;package&quot;)</span>
<span class="co">#&gt; [1] &quot;.GlobalEnv&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $number1</span>
<span class="co">#&gt; [1] 5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $number2</span>
<span class="co">#&gt; [1] 5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sum</span>
<span class="co">#&gt; [1] &quot;sum.txt&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">xmlFileName &lt;-<span class="st"> </span><span class="kw">file.path</span>(fullToolDir, <span class="kw">paste</span>(funcName, <span class="st">&quot;xml&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;.&quot;</span>))
<span class="kw">unlink</span>(xmlFileName)

xml &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;tool&quot;</span>,
                  <span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">id =</span> funcName,
                               <span class="dt">name =</span> <span class="kw">getFriendlyName</span>(funcName)))
descNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;description&quot;</span>,
                       <span class="kw">newXMLTextNode</span>(<span class="kw">paste0</span>(tools<span class="op">:::</span><span class="kw">.Rd_get_metadata</span>(rd, <span class="st">&quot;description&quot;</span>), 
                                             <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)),
                       <span class="dt">parent=</span>xml)
xml &lt;-<span class="st"> </span><span class="kw">addCommandXML</span>(funcName, funcInfo, xml)
xml &lt;-<span class="st"> </span><span class="kw">addParamsXML</span>(funcName, funcInfo, xml)

helpText &lt;-<span class="st"> </span><span class="kw">generateHelpText</span>(rd)
helpNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;help&quot;</span>, <span class="kw">newXMLTextNode</span>(helpText), <span class="dt">parent=</span>xml)
citationNode &lt;-<span class="st"> </span><span class="kw">newXMLNode</span>(<span class="st">&quot;citations&quot;</span>, <span class="dt">parent=</span>xml)
<span class="kw">saveXML</span>(xml, <span class="dt">file=</span>xmlFileName)
<span class="co">#&gt; [1] &quot;tools/mytool/addTwoNumbersWithTest.xml&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use the generate_runnable.R script </span>
<span class="co"># to make any function runnable from the command line:)</span>
scriptOut &lt;-<span class="st"> </span><span class="kw">RewriteToolScript</span>(toolScripts[<span class="dv">1</span>], <span class="dt">toolPath =</span> toolPath)
<span class="co">#&gt; Wrote the 'addTwoNumbersWithTest.R' tool R script</span></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
